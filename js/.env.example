# Supertonic TTS JavaScript - CPU Optimization Configuration

# Intel CPU Performance Tuning for ONNX Runtime
# These environment variables can significantly improve performance on Intel processors

# Number of threads for inference
# Recommended: 75% of available cores for balanced performance
# For dedicated TTS server: Use up to 100% of cores
# For shared systems: Use 50-75% of cores
# Example: For 8-core CPU, use 6 threads
OMP_NUM_THREADS=6

# Intel MKL Threading Layer (if using Intel MKL)
# Options: intel, gnu, tbb
MKL_THREADING_LAYER=intel

# Intel OpenMP settings for better thread scheduling
KMP_AFFINITY=granularity=fine,compact,1,0

# Enable Intel MKL optimizations
MKL_ENABLE_INSTRUCTIONS=AVX2

# Reduce thread spin time for better CPU utilization
KMP_BLOCKTIME=0

# Memory allocation settings for better performance
# Use jemalloc or tcmalloc if available for better memory management
# MALLOC_CONF=background_thread:true,metadata_thp:auto

# ONNX Runtime specific settings
# Graph optimization level (0=disabled, 1=basic, 2=extended, 99=all)
ORT_GRAPH_OPTIMIZATION_LEVEL=99

# Enable ONNX Runtime execution modes
# Sequential (0) or Parallel (1)
ORT_EXECUTION_MODE=1

# Number of threads per operator
ORT_INTRA_OP_NUM_THREADS=4

# Number of threads for parallel execution
ORT_INTER_OP_NUM_THREADS=2

# Notes:
# - Adjust thread counts based on your specific Intel CPU model
# - Modern Intel CPUs (10th gen+) with AVX-512 may benefit from more threads
# - For batch processing, increase INTER_OP_NUM_THREADS
# - For single requests, increase INTRA_OP_NUM_THREADS
# - Monitor CPU usage and adjust accordingly

# To use these settings:
# 1. Copy this file to .env
# 2. Modify values for your specific CPU
# 3. Load with: export $(cat .env | xargs)
# 4. Or use: source .env
